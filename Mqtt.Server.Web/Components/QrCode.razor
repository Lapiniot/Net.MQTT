@using QC = Net.Codecrete.QrCodeGenerator.QrCode
@using System.Text.RegularExpressions

<svg xmlns="http://www.w3.org/2000/svg" version="1.1"
    @attributes="@SvgAttributes"
    stroke="none" viewBox="0 0 @svgSize @svgSize">
    @ChildContent(svgPath!);
</svg>

@code {
    private string? svgPath;
    private int svgSize;

    [Parameter, EditorRequired]
    public string Text { get; set; }

    [Parameter]
    public RenderFragment<string> ChildContent { get; set; } = data =>
    @<>
        <rect width="100%" height="100%" fill="#ffffff" />
        <path d="@data" fill="#000000" />
    </>;

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object> SvgAttributes { get; set; } = new() { { "width", 300 }, { "height", 300 } };

    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        var qr = QC.EncodeText(Text, QC.Ecc.Medium);
        svgPath = qr.ToGraphicsPath();
        svgSize = qr.Size;
    }
}